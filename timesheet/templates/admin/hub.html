{% extends 'theme/base.html' %}
{% load static %}
{% block content %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="{% static 'admin/css/graficos.css' %}">
{% endblock %}

<main>
  
<div class="chart-container">
  <h2>Status dos Colaboradores</h2>
  <canvas id="chartColaboradores"></canvas>
</div>

<div class="chart-container">
  <h2>Atividades por Dia da Semana</h2>
  <div class="date-filter">
    <div class="input-group">
        <label for="dataInicio">Data Início:</label>
        <input type="date" id="dataInicio" name="data_inicio" />
    </div>

    <div class="input-group">
        <label for="dataFim">Data Fim:</label>
        <input type="date" id="dataFim" name="data_fim" />
    </div>

    <button class="filter-btn" onclick="filtrarAtividades()">Filtrar</button>
</div>
  <canvas id="barChartAtividades"></canvas>
</div>
    
</main>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var ctx = document.getElementById("chartColaboradores").getContext("2d");

  // Pegando os dados do Django
  var labels = JSON.parse('{{ labels|safe }}');
  var values = JSON.parse('{{ values|safe }}');

  var myChart = new Chart(ctx, {
      type: "doughnut",  // Tipo do gráfico
      data: {
          labels: labels,
          datasets: [{
              data: values,
              backgroundColor: ["#36A2EB", "#FF6384"], // Azul e Vermelho
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  position: "top"
              },
              tooltip: {
                  callbacks: {
                      label: function(tooltipItem) {
                          let total = values.reduce((a, b) => a + b, 0);
                          let percent = ((tooltipItem.raw / total) * 100).toFixed(2);
                          return `${tooltipItem.label}: ${tooltipItem.raw} (${percent}%)`;
                      }
                  }
              }
          }
      }
  });
});
</script>

<!--Gráfico de Barras-->

<script>
  function filtrarAtividades() {
      var dataInicio = document.getElementById("dataInicio").value;
      var dataFim = document.getElementById("dataFim").value;

      if (dataInicio && dataFim) {
          window.location.href = "?data_inicio=" + dataInicio + "&data_fim=" + dataFim;
      }
  }

  document.addEventListener("DOMContentLoaded", function () {
      var ctxAtividades = document.getElementById("barChartAtividades").getContext("2d");

      var labelsAtividades = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
      var valuesAtividades = JSON.parse('{{ atividades_por_dia|safe }}');

      new Chart(ctxAtividades, {
          type: "bar",
          data: {
              labels: labelsAtividades,
              datasets: [{
                  label: "Atividades feitas",
                  data: valuesAtividades,
                  backgroundColor: ["#3498db", "#2ecc71", "#e74c3c", "#f1c40f", "#9b59b6", "#1abc9c", "#ff5733"],
                  borderWidth: 1
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: {
                          stepSize: 1
                      }
                  }
              }
          }
      });
  });
</script>

{% endblock %}
